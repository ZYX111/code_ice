<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body onkeydown="move(event)">
<canvas id="tankMap" width="720px" height="660px" style="color:black">
</canvas>
<script type="text/javascript">

var canvas = document.getElementById("tankMap");
var cxt = canvas.getContext("2d");

var w = 60,h = 60;//w为宽，h为高
//坦克：xy坐标，导弹等级，装甲等级,方向
//导弹：导弹等级，xy坐标，方向
//墙：xy坐标
//导弹升级包：xy
//装甲升级包：xy
//方法:void 导弹发射（），void 升级装甲（），void 升级导弹（），void 放置装甲（），void 放置导弹（），刷新（），车移动（）
//全局:地图【【】】，墙【】，导弹升级包【】，装甲升级包【】，子弹【】

var MAP=[//
	[0,0,0,0,0,0,0,0,0,0,0,0],
	[0,1,1,1,1,1,0,0,0,0,0,0],
	[0,1,0,0,0,1,0,0,0,0,0,0],
	[0,1,0,0,0,1,0,1,1,1,0,0],
	[0,1,0,0,0,1,0,1,0,1,0,0],
	[0,1,1,1,0,1,1,1,0,1,0,0],
	[0,0,1,1,0,0,0,0,0,1,0,0],
	[0,0,1,0,0,0,1,0,0,1,0,0],
	[0,0,1,0,0,0,1,1,1,1,0,0],
	[0,0,1,1,1,1,1,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0]		
]; 

var oImgs={//建立图片数组，便于预加载
		"down" : "image/enemy3D.png",
		"left" : "image/enemy3L.png",
		"right" : "image/enemy3R.png",
		"up" : "image/enemy3U.png",  
		"wall" : "image/walls.png",
		"road" : "image/GroundGravel_Sand.png",
		"bullet" : "image/enemymissile.png"
}

function imgPreload(srcs,callback){//图片预加载函数
	var count = 0,imgNum = 0,images = {};

	for(src in srcs){
			imgNum++;
	}
	//console.log(imgNum);
	for(src in srcs ){
		images[src] = new Image();
		images[src].onload = function(){
		//判断是否所有的图片都预加载完成
			if (++count >= imgNum)
			{
				callback(images);
			}
		}
		images[src].src = srcs[src];
	}
}   

var down,left,right,up,wall,road,bullet;//定义图片对象

imgPreload(oImgs,function(images){
		//console.log(images.road);
		down = images.down;
		left = images.left;
		right = images.right;
		up = images.up;
		wall = images.wall;
		road = images.road;
		bullet = images.bullet;
		init();
}); 

function Tank(x,y,direct){//定义一个Tank类
	this.x=x;//x坐标
	this.y=y;//y坐标
	this.speed=3;//移动速度（每次移动的像素点数）
	this.direct=direct;//方向
	this.moveUp=function(){
		this.y-=this.speed;
	}
	this.moveDown=function(){
		this.y+=this.speed;
	}
	this.moveRight=function(){
		this.x+=this.speed;
	}
	this.moveLeft=function(){
		this.x-=this.speed;
	}
	this.shot=function(){
		
	}
}

function Wall(x,y){//建立Wall类
	this.x=x;
	this.y=y;
	this.draw=function(i, j){
		cxt.drawImage(wall,w*i,h*j,w,h);
	}
}

var curTank = new Tank(180,180,0);//初始化坦克
	
var wallGroup=new Array();//创建墙的数组

function init(){
		InitMap();//初始化地板
		drawTank(curTank);
}

function InitMap(){
	for(var i=0;i<11;i++)
	{
		for(var j=0;j<13;j++)
		{
			if(MAP[i][j] == 1){
				wallGroup[i+j]=new Wall(i,j);
				wallGroup[i+j].draw(i,j);
			}else if(MAP[i][j] == 0){
				cxt.drawImage(road,w*i,h*j,w,h);
			}
		}
	}
}

//规定：0代表上，1代表右，2代表下，3代表左。
//绘制坦克封装成函数。
//参数里面传入的是tank对象
function drawTank(tank){
	//设置颜色
	switch(tank.direct){
		case 0:
		case 2:
		if(tank.direct==0){
			cxt.drawImage(up,tank.x,tank.y,w,h);
		}
		else if(tank.direct==2){	
			cxt.drawImage(down,tank.x,tank.y,w,h);
		}
		break;
		case 1:
		case 3:
		if(tank.direct==1){
			cxt.drawImage(left,tank.x,tank.y,w,h);
		}
		else if(tank.direct==3){
			cxt.drawImage(right,tank.x,tank.y,w,h);
		}
		break;
	}
}

function move(event){
	switch(event.keyCode){
		case 38:curTank.moveUp();curTank.direct=0; break;
		case 37:curTank.moveLeft();curTank.direct=3; break;
		case 40:curTank.moveDown();curTank.direct=2; break;
		case 39:curTank.moveRight();curTank.direct=1; break; 
		case 32:curTank.shot();break;
	}
	InitMap();
	drawTank(curTank);
}	
</script>
<!-- function 判断撞墙(){
	for（）{
		遍历墙数组元素i；
		if(i的xy成员变量与坦克xy，比较){
			.....
		}else{
			......
		}
	}
} -->


</body>
</html>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body onkeydown="move(event)">
<canvas id="tankMap" width="720px" height="660px" style="color:black">
</canvas>
<script type="text/javascript">

var canvas = document.getElementById("tankMap");
var cxt = canvas.getContext("2d");

var w = 60,h = 60;//w为宽，h为高

var MAP=[
	[0,0,0,0,0,0,0,0,0,0,0,0],
	[0,1,1,1,1,1,0,0,0,0,0,0],
	[0,1,0,0,0,1,0,0,0,0,0,0],
	[0,1,0,0,0,1,0,1,1,1,0,0],
	[0,1,0,0,0,1,0,1,0,1,0,0],
	[0,1,1,1,0,1,1,1,0,1,0,0],
	[0,0,1,1,0,0,0,0,0,1,0,0],
	[0,0,1,0,0,0,1,0,0,1,0,0],
	[0,0,1,0,0,0,1,1,1,1,0,0],
	[0,0,1,1,1,1,1,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0,0,0]		
]; 

function tank(x,y,direct){//定义一个tank类
	this.x=x;//x坐标
	this.y=y;//y坐标
	this.speed=3;//移动速度（每次移动的像素点数）
	this.direct=direct;//方向
	this.moveUp=function(){
		this.y-=this.speed;
	}
	this.moveDown=function(){
		this.y+=this.speed;
	}
	this.moveRight=function(){
		this.x+=this.speed;
	}
	this.moveLeft=function(){
		this.x-=this.speed;
	}
}

var curTank = new tank(180,180,0);
	
var oImgs={
		"down" : "image/enemy3D.png",
		"left" : "image/enemy3L.png",
		"right" : "image/enemy3R.png",
		"up" : "image/enemy3U.png",  
		"wall" : "image/walls.png",
		"road" : "image/GroundGravel_Sand.png"
}

function imgPreload(srcs,callback){
	var count = 0,imgNum = 0,images = {};

	for(src in srcs){
			imgNum++;
	}
	//console.log(imgNum);
	for(src in srcs ){
		images[src] = new Image();
		images[src].onload = function(){
		//判断是否所有的图片都预加载完成
			if (++count >= imgNum)
			{
				callback(images);
			}
		}
		images[src].src = srcs[src];
	}
}   

var down,left,right,up,wall,road;

imgPreload(oImgs,function(images){
		//console.log(images.road);
		down = images.down;
		left = images.left;
		right = images.right;
		up = images.up;
		wall = images.wall;
		road = images.road;
		init();
});  

function init(){
		InitMap();//初始化地板
		drawTank(curTank);
}

function InitMap(){
	for(var i=0;i<11;i++)
	{
		for(var j=0;j<13;j++)
		{
			if(MAP[i][j] == 1){
				cxt.drawImage(wall,w*i,h*j,w,h);
			}else if(MAP[i][j] == 0){
				cxt.drawImage(road,w*i,h*j,w,h);
			}
		}
	}
}

//规定：0代表上，1代表右，2代表下，3代表左。
//绘制坦克封装成函数。
//参数里面传入的是tank对象
function drawTank(tank){
	//设置颜色
	switch(tank.direct){
		case 0:
		case 2:
		if(tank.direct==0){
			cxt.drawImage(up,tank.x,tank.y,w,h);
		}
		else if(tank.direct==2){	
			cxt.drawImage(down,tank.x,tank.y,w,h);
		}
		break;
		case 1:
		case 3:
		if(tank.direct==1){
			cxt.drawImage(left,tank.x,tank.y,w,h);
		}
		else if(tank.direct==3){
			cxt.drawImage(right,tank.x,tank.y,w,h);
		}
		break;
	}
}

function move(event){
	switch(event.keyCode){
		case 38:curTank.moveUp();curTank.direct=0; break;
		case 37:curTank.moveLeft();curTank.direct=3; break;
		case 40:curTank.moveDown();curTank.direct=2; break;
		case 39:curTank.moveRight();curTank.direct=1; break; 
	}
	InitMap();
	drawTank(curTank);
}	
</script>


</body>
</html>